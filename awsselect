#!/bin/bash

# Herramienta interactiva para cambiar entre perfiles de AWS

# Obtener lista de perfiles desde ~/.aws/credentials
profiles=$(awk -F'[][]' '/\[.*\]/{print $2}' ~/.aws/credentials)

# Verificar si hay perfiles configurados
if [ -z "$profiles" ]; then
    echo "âš ï¸  No se encontraron perfiles en ~/.aws/credentials"
    exit 1
fi

echo "ğŸ” Perfiles disponibles:"
select profile in $profiles; do
    if [ -n "$profile" ]; then
        export AWS_PROFILE="$profile"
        echo "âœ… AWS_PROFILE seteado a: $AWS_PROFILE"

        # Mostrar informaciÃ³n de la cuenta actual
        identity=$(aws sts get-caller-identity --output text 2>/dev/null)
        if [ $? -eq 0 ]; then
            echo "ğŸ” Cuenta activa:"
            echo "$identity"
        else
            echo "âš ï¸  No se pudo verificar la identidad con 'aws sts get-caller-identity'"
        fi
        break
    else
        echo "âŒ OpciÃ³n invÃ¡lida. IntentÃ¡ de nuevo."
    fi
done